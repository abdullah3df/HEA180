<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>حاسبة قص الأجنحة — زاوية واحدة بعد الجمع</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo } = React;

    // ثوابت داخلية (لا تظهر)
    const TF_CONST = 16; // mm (غير مستخدم بالحساب، للعلم فقط)
    const TW_CONST = 10; // mm مهم للحساب: F = (b - tw)/2

    // حساب من زاوية أو من مقدار قص (زاوية واحدة و s واحدة تطبّق على العلوي والسفلي معًا)
    function solve(b, tw, mode, thetaDeg, sInput){
      const F = Math.max(0, (b - tw)/2);
      if (b<=0 || F===0) return {F, s:0, theta:0, r: b, valid:false};

      if (mode === 'angle'){
        const theta = Math.max(0, Math.min(120, thetaDeg||0)); // درجة
        const a = (theta/2) * Math.PI/180;
        const s = Math.max(0, Math.min(b, F * Math.tan(a)));
        const r = Math.max(0, b - s);
        return {F, s, theta, r, valid:true};
      } else {
        const sRaw = Math.max(0, sInput||0);
        const s = Math.min(b, sRaw);
        const theta = s===0 ? 0 : (2 * Math.atan(s / F)) * 180/Math.PI;
        const r = Math.max(0, b - s);
        return {F, s, theta, r, valid:true};
      }
    }

    // شريط معاينة واحد لجناح (نستخدمه مرتين: علوي وسفلي)
    function FlangeBar({ b, s, side, label }){
      const W=420, H=70, x0=30, y=35, barMax=360;
      const scale = b>0 ? barMax/b : 1;
      const sPx = Math.max(0, Math.min(barMax, s*scale));
      const bodyPx = Math.max(0, barMax - sPx);

      const leftCut  = side==='left';
      const xStart   = x0 + (leftCut ? 0 : 0);
      const xBody1   = leftCut ? (x0 + sPx) : x0;
      const xBody2   = leftCut ? (x0 + sPx + bodyPx) : (x0 + bodyPx);
      const xCut1    = leftCut ? x0 : (x0 + bodyPx);
      const xCut2    = leftCut ? (x0 + sPx) : (x0 + bodyPx + sPx);

      return (
        <svg width={W} height={H} viewBox={`0 0 ${W} ${H}`} className="bg-white rounded shadow">
          <text x={W/2} y="16" fontSize="12" textAnchor="middle" fill="#334155">{label}</text>
          {/* كامل العرض كمسطرة */}
          <line x1={x0} y1={y} x2={x0+barMax} y2={y} stroke="#e5e7eb" strokeWidth="12"/>
          {/* المتبقي */}
          {bodyPx>0 && <line x1={xBody1} y1={y} x2={xBody2} y2={y} stroke="#6b7280" strokeWidth="12"/>}
          {/* المقطوع */}
          {sPx>0 && <line x1={xCut1} y1={y} x2={xCut2} y2={y} stroke="#ef4444" strokeWidth="12"/>}
          {/* أبعاد مبسطة */}
          <text x={x0} y={y+22} fontSize="11" fill="#374151">b={b}mm</text>
          <text x={x0+barMax} y={y-16} fontSize="11" textAnchor="end" fill="#ef4444">s={s.toFixed(2)}mm</text>
        </svg>
      );
    }

    function App(){
      const [b, setB] = useState(180);        // عرض الجناح الكلي (mm)
      const [mode, setMode] = useState('angle'); // وضع الإدخال: زاوية أو قص
      const [theta, setTheta] = useState(16); // درجة (عند وضع الزاوية)
      const [sInput, setSInput] = useState(0);// مم (عند وضع القص)
      const [side, setSide] = useState('left'); // جهة القص: يسار/يمين – تطبَّق على العلوي والسفلي

      const out = useMemo(()=>solve(b, TW_CONST, mode, theta, sInput), [b, mode, theta, sInput]);

      return (
        <div dir="rtl" className="min-h-screen p-6">
          <div className="max-w-3xl mx-auto bg-white rounded-xl shadow-lg p-6">
            <h1 className="text-2xl font-bold mb-2 text-center">حاسبة قص الأجنحة — زاوية واحدة بعد الجمع</h1>
            <p className="text-sm text-gray-600 text-center mb-4">
              المعادلة: <span className="font-mono">s = F · tan(θ/2)</span> و <span className="font-mono">θ = 2·atan(s/F)</span>،
              حيث <span className="font-mono">F = (b − t<sub>w</sub>)/2</span>، و <span className="font-mono">t<sub>w</sub> = {TW_CONST}mm</span> (ثابت داخلي).
            </p>

            {/* إدخالات عامة */}
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div className="md:col-span-1">
                <label className="block font-semibold mb-1">عرض الجناح b (مم)</label>
                <input type="number" min="1" step="0.1" value={b}
                       onChange={e=>setB(parseFloat(e.target.value)||0)}
                       className="w-full p-2 border rounded"/>
                <div className="text-xs text-gray-500 mt-1">
                  (سماكة الجناح والعمود ثابتة داخليًا)
                </div>
              </div>

              <div className="md:col-span-1">
                <label className="block font-semibold mb-1">وضع الإدخال</label>
                <select className="w-full p-2 border rounded" value={mode} onChange={e=>setMode(e.target.value)}>
                  <option value="angle">أدخل الزاوية المطلوبة</option>
                  <option value="cut">أدخل مقدار القص (s)</option>
                </select>
              </div>

              <div className="md:col-span-1">
                <label className="block font-semibold mb-1">جهة القص (تُطبق على العلوي والسفلي)</label>
                <div className="flex gap-4 items-center">
                  <label className="flex items-center gap-2">
                    <input type="radio" name="side" value="left" checked={side==='left'} onChange={e=>setSide(e.target.value)}/>
                    يسار
                  </label>
                  <label className="flex items-center gap-2">
                    <input type="radio" name="side" value="right" checked={side==='right'} onChange={e=>setSide(e.target.value)}/>
                    يمين
                  </label>
                </div>
              </div>
            </div>

            {/* إدخال الزاوية أو القص */}
            <div className="mt-4">
              {mode==='angle' ? (
                <>
                  <label className="block font-semibold mb-1">
                    الزاوية المطلوبة θ: <b>{theta}°</b>
                  </label>
                  <input type="range" min="0" max="60" step="1" value={theta}
                         onChange={e=>setTheta(parseFloat(e.target.value)||0)}
                         className="w-full"/>
                </>
              ) : (
                <>
                  <label className="block font-semibold mb-1">مقدار القص المطلوب s (مم)</label>
                  <input type="number" min="0" step="0.1" value={sInput}
                         onChange={e=>setSInput(parseFloat(e.target.value)||0)}
                         className="w-full p-2 border rounded"/>
                </>
              )}
            </div>

            {/* النتائج */}
            {out && out.valid ? (
              <div className="mt-4 bg-gray-50 border rounded p-4">
                <h2 className="font-bold mb-2">النتائج</h2>
                <div className="grid grid-cols-1 md:grid-cols-4 gap-3 text-center">
                  <div className="p-2 rounded bg-slate-50 border">
                    <div className="text-sm text-slate-600">F (بروز الجناح)</div>
                    <div className="text-lg font-bold">{out.F.toFixed(2)} مم</div>
                  </div>
                  <div className="p-2 rounded bg-red-50 border border-red-200">
                    <div className="text-sm text-red-600">المقطوع s (مم)</div>
                    <div className="text-lg font-bold text-red-700">{out.s.toFixed(2)}</div>
                  </div>
                  <div className="p-2 rounded bg-emerald-50 border border-emerald-200">
                    <div className="text-sm text-emerald-700">المتبقي r (مم)</div>
                    <div className="text-lg font-bold text-emerald-800">{out.r.toFixed(2)}</div>
                  </div>
                  <div className="p-2 rounded bg-indigo-50 border border-indigo-200">
                    <div className="text-sm text-indigo-700">الزاوية بعد الجمع θ (°)</div>
                    <div className="text-lg font-bold text-indigo-800">{out.theta.toFixed(2)}</div>
                  </div>
                </div>
              </div>
            ) : (
              <div className="mt-4 text-red-600">تحقق من القيم.</div>
            )}

            {/* المعاينة (علوي + سفلي بنفس القص والجهة) */}
            {out && out.valid && (
              <div className="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                <FlangeBar b={b} s={out.s} side={side} label="معاينة الجناح العلوي"/>
                <FlangeBar b={b} s={out.s} side={side} label="معاينة الجناح السفلي"/>
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
  </script>
</body>
</html>
