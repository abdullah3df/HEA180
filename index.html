<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>حاسبة زاوية التجميع من فرق القص</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100" dir="rtl">
  <div class="min-h-screen p-6">
    <div class="max-w-3xl mx-auto bg-white rounded-xl shadow-lg p-6">
      <h1 class="text-2xl font-bold text-center mb-2">حاسبة زاوية التجميع من فرق القص</h1>
      <p class="text-sm text-gray-600 text-center mb-4">
        الزاوية المحصّلة تُحسب من فرق القص بين العلوي والسفلي:
        <span class="font-mono">θ = 2 · atan(Δs / F)</span>،
        حيث <span class="font-mono">Δs = s<sub>top</sub> − s<sub>bottom</sub></span>،
        و <span class="font-mono">F = (b − t<sub>w</sub>)/2</span> مع <span class="font-mono">t<sub>w</sub>=8.5 mm</span>.
      </p>

      <!-- إدخال b -->
      <div class="mb-4">
        <label class="block font-semibold mb-1">عرض الجناح الكلي b (مم)</label>
        <input id="b" type="number" min="1" step="0.1" value="180"
               class="w-full p-2 border rounded"/>
        <div class="text-xs text-gray-500 mt-1">يُعاد ضبط حدود السلايدر تلقائيًا حسب F.</div>
      </div>

      <!-- بطاقة F -->
      <div class="bg-slate-50 border rounded p-3 mb-4 text-center">
        <div class="text-sm text-slate-600">F (بروز الجناح) = (b − t<sub>w</sub>)/2</div>
        <div id="FVal" class="text-xl font-bold">—</div>
      </div>

      <!-- سلايدر العلوي -->
      <div class="mb-4 p-3 border rounded">
        <div class="flex items-center justify-between mb-1">
          <label class="font-semibold">قص الجناح العلوي s<sub>top</sub> (مم)</label>
          <div class="text-sm text-gray-700"><span id="sTopVal">0.00</span> مم</div>
        </div>
        <input id="sTop" type="range" min="0" max="100" step="0.1" value="0" class="w-full"/>
        <div class="text-xs text-gray-500 mt-1">المتبقي r<sub>top</sub> = <span id="rTop">—</span> مم</div>
      </div>

      <!-- سلايدر السفلي -->
      <div class="mb-4 p-3 border rounded">
        <div class="flex items-center justify-between mb-1">
          <label class="font-semibold">قص الجناح السفلي s<sub>bottom</sub> (مم)</label>
          <div class="text-sm text-gray-700"><span id="sBottomVal">0.00</span> مم</div>
        </div>
        <input id="sBottom" type="range" min="0" max="100" step="0.1" value="0" class="w-full"/>
        <div class="text-xs text-gray-500 mt-1">المتبقي r<sub>bottom</sub> = <span id="rBottom">—</span> مم</div>
      </div>

      <!-- النتائج -->
      <div class="bg-indigo-50 border border-indigo-200 rounded p-4 text-center">
        <div class="text-sm text-indigo-700">زاوية التجميع الناتجة</div>
        <div id="thetaOut" class="text-3xl font-extrabold text-indigo-800">—</div>
        <div class="text-xs text-gray-600 mt-1">
          إشارة (+) تعني الفتح باتجاه الأعلى، و(−) باتجاه الأسفل. إذا كان s<sub>top</sub>=s<sub>bottom</sub> ⇒ θ=0°.
        </div>
      </div>

      <!-- المعاينة -->
      <div class="mt-6 bg-white border rounded p-3">
        <svg id="preview" width="100%" viewBox="0 0 560 180" class="block mx-auto">
          <!-- يُرسم ديناميكيًا -->
        </svg>
      </div>
    </div>
  </div>

  <script>
    // ثابت سماكة "العمود"
    const tw = 8.5;

    // عناصر DOM
    const elB = document.getElementById('b');
    const elFVal = document.getElementById('FVal');

    const elSTop = document.getElementById('sTop');
    const elSBottom = document.getElementById('sBottom');
    const elSTopVal = document.getElementById('sTopVal');
    const elSBottomVal = document.getElementById('sBottomVal');
    const elRTop = document.getElementById('rTop');
    const elRBottom = document.getElementById('rBottom');

    const elThetaOut = document.getElementById('thetaOut');
    const svg = document.getElementById('preview');
    const NS = "http://www.w3.org/2000/svg";

    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
    function deg(x){ return x * 180 / Math.PI; }

    function compute(){
      const b = parseFloat(elB.value)||0;
      const F = (b - tw)/2;
      elFVal.textContent = F>0 ? F.toFixed(2)+' مم' : '—';

      // حد السلايدر = F (مع هامش صغير)
      const maxRange = Math.max(0, F);
      elSTop.max = maxRange; elSBottom.max = maxRange;

      const sTop = clamp(parseFloat(elSTop.value)||0, 0, maxRange);
      const sBottom = clamp(parseFloat(elSBottom.value)||0, 0, maxRange);

      elSTopVal.textContent = sTop.toFixed(2);
      elSBottomVal.textContent = sBottom.toFixed(2);

      const rTop = Math.max(0, b - sTop);
      const rBottom = Math.max(0, b - sBottom);
      elRTop.textContent = rTop.toFixed(2);
      elRBottom.textContent = rBottom.toFixed(2);

      // الزاوية من فرق القص
      let theta = 0;
      if (F>0){
        const delta = sTop - sBottom; // موجب = فتح للأعلى
        theta = 2 * deg(Math.atan(delta / F));
      }
      const sign = theta>0 ? '+' : (theta<0 ? '−' : '');
      elThetaOut.textContent = `${sign}${Math.abs(theta).toFixed(2)}°`;

      drawPreview(b, sTop, sBottom);
    }

    function drawPreview(b, sTop, sBottom){
      svg.innerHTML = '';
      const W = 560, H = 180, x0 = 40, bar = 480, cy1 = 60, cy2 = 130;
      const scale = b>0 ? bar / b : 1;

      // دوال مساعدة
      const line = (x1,y1,x2,y2,stroke,w)=>{
        const l=document.createElementNS(NS,'line');
        l.setAttribute('x1',x1); l.setAttribute('y1',y1);
        l.setAttribute('x2',x2); l.setAttribute('y2',y2);
        l.setAttribute('stroke',stroke); l.setAttribute('stroke-width',w||12);
        svg.appendChild(l);
      };
      const text = (x,y,t,fs,fill,anc)=>{
        const el=document.createElementNS(NS,'text');
        el.setAttribute('x',x); el.setAttribute('y',y);
        el.setAttribute('font-size',fs||'12');
        el.setAttribute('fill',fill||'#111');
        el.setAttribute('text-anchor',anc||'middle');
        el.textContent=t; svg.appendChild(el);
      };

      // شريط علوي
      line(x0, cy1, x0+bar, cy1, '#e5e7eb', 12);
      const sTopPx = clamp(sTop*scale, 0, bar);
      line(x0, cy1, x0+sTopPx, cy1, '#ef4444', 12);
      line(x0+sTopPx, cy1, x0+bar, cy1, '#6b7280', 12);
      text(x0+bar/2, cy1-16, 'الجناح العلوي', '11', '#334155');

      // شريط سفلي
      line(x0, cy2, x0+bar, cy2, '#e5e7eb', 12);
      const sBottomPx = clamp(sBottom*scale, 0, bar);
      line(x0, cy2, x0+sBottomPx, cy2, '#ef4444', 12);
      line(x0+sBottomPx, cy2, x0+bar, cy2, '#6b7280', 12);
      text(x0+bar/2, cy2+22, 'الجناح السفلي', '11', '#334155');

      // b و قيم s
      text(x0, cy2+44, `b = ${b} mm`, '11', '#374151', 'start');
      text(x0+bar, cy1-28, `s_top = ${sTop.toFixed(2)} mm`, '11', '#ef4444', 'end');
      text(x0+bar, cy2-12, `s_bottom = ${sBottom.toFixed(2)} mm`, '11', '#ef4444', 'end');
    }

    // أحداث
    ['input','change'].forEach(evt=>{
      elB.addEventListener(evt, compute);
      elSTop.addEventListener(evt, compute);
      elSBottom.addEventListener(evt, compute);
    });

    // أول تشغيل
    compute();
  </script>
</body>
</html>
