<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>حاسبة زاوية التجميع — HEB 180 (قص الجناح العلوي)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div class="min-h-screen p-6" dir="rtl">
    <div class="max-w-xl mx-auto bg-white rounded-xl shadow-lg p-6">
      <h1 class="text-2xl font-bold mb-2 text-center">حاسبة زاوية التجميع — HEB 180</h1>
      <p class="text-sm text-gray-600 text-center mb-4">
        نفترض قص شريط مستقيم من <b>الجناح العلوي فقط</b> لكل قطعة ثم جمع القطعتين.
        المعادلة: <span class="font-mono">s = F · tan(θ/2)</span> و
        <span class="font-mono">θ = 2·atan(s/F)</span> حيث
        <span class="font-mono">F = (b − t<sub>w</sub>)/2</span>.
      </p>

      <!-- ثوابت المقطع (مخفاة، للعرض فقط) -->
      <div class="bg-slate-50 border rounded p-3 mb-4 text-sm">
        <div>المقطع: <b>HEB 180</b></div>
        <div>b = <b>180</b> مم، t<sub>w</sub> = <b>8.5</b> مم (ثابتان)</div>
      </div>

      <!-- اختيار وضع الإدخال -->
      <div class="mb-4">
        <label class="block font-semibold mb-1">وضع الإدخال</label>
        <select id="mode" class="w-full p-2 border rounded">
          <option value="angle">أدخل الزاوية المطلوبة (θ)</option>
          <option value="cut">أدخل مقدار القص (s)</option>
        </select>
      </div>

      <!-- إدخال الزاوية -->
      <div id="angleInputs" class="mb-4">
        <label class="block font-semibold mb-1">الزاوية المطلوبة θ: <b><span id="thetaLabel">16</span>°</b></label>
        <input id="thetaRange" type="range" min="0" max="60" step="1" value="16" class="w-full" />
      </div>

      <!-- إدخال مقدار القص -->
      <div id="cutInputs" class="mb-4 hidden">
        <label class="block font-semibold mb-1">مقدار القص s (مم) — لكل قطعة</label>
        <input id="sInput" type="number" min="0" step="0.1" value="3" class="w-full p-2 border rounded" />
      </div>

      <!-- النتائج -->
      <div class="bg-gray-50 border rounded p-4">
        <h2 class="font-bold mb-2">النتائج</h2>
        <div class="grid grid-cols-2 gap-3 text-center">
          <div class="p-2 rounded bg-slate-50 border">
            <div class="text-sm text-slate-600">F (بروز الجناح)</div>
            <div id="FVal" class="text-lg font-bold">—</div>
          </div>
          <div class="p-2 rounded bg-indigo-50 border border-indigo-200">
            <div class="text-sm text-indigo-700">زاوية التجميع θ (°)</div>
            <div id="thetaOut" class="text-lg font-bold text-indigo-800">—</div>
          </div>
          <div class="p-2 rounded bg-red-50 border border-red-200">
            <div class="text-sm text-red-600">المقطوع s (مم)</div>
            <div id="sOut" class="text-lg font-bold text-red-700">—</div>
          </div>
          <div class="p-2 rounded bg-emerald-50 border border-emerald-200">
            <div class="text-sm text-emerald-700">المتبقي r = b − s (مم)</div>
            <div id="rOut" class="text-lg font-bold text-emerald-800">—</div>
          </div>
        </div>
        <p class="mt-3 text-xs text-gray-600">
          b = 180 مم، t<sub>w</sub> = 8.5 مم ⇒ F = (180 − 8.5) / 2 = 85.75 مم.
        </p>
      </div>

      <!-- معاينة شريطية بسيطة للجناح العلوي فقط -->
      <div class="mt-6">
        <svg id="preview" width="420" height="80" viewBox="0 0 420 80" class="bg-white rounded shadow">
          <!-- تُملأ ديناميكيًا -->
        </svg>
      </div>
    </div>
  </div>

  <script>
    // ثوابت HEB 180
    const b = 180;
    const tw = 8.5;
    const F = (b - tw) / 2;

    // عناصر
    const modeSel = document.getElementById('mode');
    const angWrap = document.getElementById('angleInputs');
    const cutWrap = document.getElementById('cutInputs');
    const thetaRange = document.getElementById('thetaRange');
    const thetaLabel = document.getElementById('thetaLabel');
    const sInput = document.getElementById('sInput');

    const FVal = document.getElementById('FVal');
    const thetaOut = document.getElementById('thetaOut');
    const sOut = document.getElementById('sOut');
    const rOut = document.getElementById('rOut');

    const svg = document.getElementById('preview');

    FVal.textContent = F.toFixed(2) + ' مم';

    function solveByAngle(thetaDeg){
      const a = (thetaDeg/2) * Math.PI/180;
      const s = Math.max(0, Math.min(b, F * Math.tan(a)));
      const r = Math.max(0, b - s);
      return {theta: thetaDeg, s, r};
    }

    function solveByCut(sVal){
      const s = Math.max(0, Math.min(b, sVal));
      const theta = s === 0 ? 0 : (2 * Math.atan(s / F)) * 180/Math.PI;
      const r = Math.max(0, b - s);
      return {theta, s, r};
    }

    function drawPreview(sVal){
      // معاينة بسيطة: مسطرة b، أحمر = المقطوع من الجهة المختارة (نفترض اليسار)
      const W=420, x0=30, y=40, bar=360;
      const scale = bar / b;
      const sPx = Math.max(0, Math.min(bar, sVal * scale));
      const rPx = Math.max(0, bar - sPx);

      svg.innerHTML = '';
      const line = (x1,y1,x2,y2,stroke,w)=> {
        const l=document.createElementNS('http://www.w3.org/2000/svg','line');
        l.setAttribute('x1',x1); l.setAttribute('y1',y1);
        l.setAttribute('x2',x2); l.setAttribute('y2',y2);
        l.setAttribute('stroke',stroke); l.setAttribute('stroke-width',w);
        svg.appendChild(l);
      };
      const text = (x,y,t,fill='black',anchor='start')=>{
        const el=document.createElementNS('http://www.w3.org/2000/svg','text');
        el.setAttribute('x',x); el.setAttribute('y',y);
        el.setAttribute('font-size','11'); el.setAttribute('fill',fill);
        el.setAttribute('text-anchor',anchor);
        el.textContent=t; svg.appendChild(el);
      };

      line(x0, y, x0+bar, y, '#e5e7eb', 12);       // كامل b
      line(x0, y, x0+sPx, y, '#ef4444', 12);       // المقطوع يسار
      line(x0+sPx, y, x0+sPx+rPx, y, '#6b7280', 12); // المتبقي
      text(x0, y+22, `b = ${b} mm`, '#374151');
      text(x0+bar, y-14, `s = ${ (sVal||0).toFixed(2) } mm`, '#ef4444', 'end');
    }

    function update(){
      let res;
      if (modeSel.value === 'angle'){
        const th = parseFloat(thetaRange.value) || 0;
        thetaLabel.textContent = th;
        res = solveByAngle(th);
      } else {
        const sVal = parseFloat(sInput.value) || 0;
        res = solveByCut(sVal);
      }
      thetaOut.textContent = res.theta.toFixed(2);
      sOut.textContent = res.s.toFixed(2);
      rOut.textContent = res.r.toFixed(2);
      drawPreview(res.s);
    }

    modeSel.addEventListener('change', ()=>{
      const byAngle = modeSel.value === 'angle';
      angWrap.classList.toggle('hidden', !byAngle);
      cutWrap.classList.toggle('hidden', byAngle);
      update();
    });
    thetaRange.addEventListener('input', update);
    sInput.addEventListener('input', update);

    // بداية
    update();
  </script>
</body>
</html>
